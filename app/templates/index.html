<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/favicon.png" type="image/png">
    <meta name="description" content="ToDo List application using FastAPI, SQLModel and Bootstrap 5">
    <title>ToDo List (FastAPI and SQLModel)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
    <div class="container py-5">
        <h1 class="mb-4 text-center">ToDo List (FastAPI and SQLModel)</h1>
        <div class="card mb-4">
            <div class="card-body">
                <form id="task-form" class="row g-2 align-items-center">
                    <div class="input-group mb-3">
                        <input type="text" id="task-title" class="form-control" placeholder="Enter the task title"
                            required>
                    </div>
                    <div class="input-group mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="task-done">
                            <label class="form-check-label" for="task-done">Done</label>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Add</button>
                </form>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Tasks</h5>
                <ul id="task-list" class="list-group">
                    <!-- Tasks will be inserted here via JavaScript -->
                </ul>
            </div>
        </div>
    </div>

    <script>
        const taskForm = document.getElementById('task-form');
        const taskList = document.getElementById('task-list');
        // Load tasks from the API (GET).
        async function loadTasks() {
            taskList.innerHTML = '';
            const response = await fetch('http://127.0.0.1:8000/tasks/');
            const tasks = await response.json();

            tasks.forEach(task => {
                const listItem = document.createElement('li');
                listItem.className = 'list-group-item d-flex align-items-center justify-content-between';

                const input = document.createElement('input');
                input.type = 'text';
                input.value = task.title;
                input.className = 'form-control me-2';
                input.style.maxWidth = '60%';
                input.addEventListener('change', () => updateTask(task.id, input.value, checkbox.checked));

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = task.done;
                checkbox.className = 'form-check-input me-2';
                checkbox.addEventListener('change', () => updateTask(task.id, input.value, checkbox.checked));

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger btn-sm ms-2';
                deleteBtn.textContent = 'Remover';
                deleteBtn.addEventListener('click', () => deleteTask(task.id));

                const wrapper = document.createElement('div');
                wrapper.className = 'd-flex align-items-center flex-grow-1';
                wrapper.appendChild(checkbox);
                wrapper.appendChild(input);

                listItem.appendChild(wrapper);
                listItem.appendChild(deleteBtn);
                taskList.appendChild(listItem);
            });
        }
        // Create task (POST).
        taskForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('task-title').value.trim();
            const done = document.getElementById('task-done').checked;

            if (!title) return;

            await fetch('http://127.0.0.1:8000/tasks/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ title, done })
            });

            taskForm.reset();
            loadTasks();
        });
        // Update task (PUT).
        async function updateTask(id, title, done) {
            await fetch(`http://127.0.0.1:8000/tasks/${id}/`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ title, done })
            });
        }
        // Delete task (DELETE).
        async function deleteTask(id) {
            await fetch(`http://127.0.0.1:8000/tasks/${id}/`, {
                method: 'DELETE'
            });
            loadTasks();
        }

        loadTasks();
    </script>
</body>

</html>